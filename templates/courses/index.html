{% extends 'base.html' %}
{% block title %}Cursos — Impulsa{% endblock %}
{% block content %}
	<h2>Cursos</h2>
	<p>Módulo de gestión de cursos y matrículas.</p>

	<div class="actions">
		{% if user.is_authenticated %}
			{% if user.is_superuser or 'courses.add_course' in user_perms %}
				<a class="button" href="{% url 'courses:add' %}">Agregar curso</a>
				<a class="button" href="{% url 'courses:add_material' %}">Asignar materia a curso</a>
			{% endif %}
		{% endif %}
	</div>

	{% if courses %}
	<table class="table">
		<thead>
			<tr>
				<th>Curso</th>
				<th>Nivel</th>
				<th>División</th>
				<th>Especialidad</th>
				<th>Inscripciones</th>
				<th>Materias</th>
				<th>Acciones</th>
			</tr>
		</thead>
		<tbody>
			{% for item in courses %}
			<tr>
				<td>{{ item.instance.name }}</td>
				<td>{{ item.instance.level.name }}</td>
				<td>{{ item.instance.division.name }}</td>
				<td>{% if item.instance.specialty %}{{ item.instance.specialty.name }}{% else %}—{% endif %}</td>
				<td>{{ item.enrollments }}</td>
				<td>
					{% for material in item.instance.materials.all %}
						<div>{{ material.subject.name }} (Prof. {{ material.teacher.last_name }})
						{% if user.is_authenticated %}
							{% if user.is_superuser or 'courses.change_coursematerial' in user_perms %}
								<a href="{% url 'courses:edit_material' material.pk %}">Editar</a>
							{% endif %}
							{% if user.is_superuser or 'courses.delete_coursematerial' in user_perms %}
								<a href="{% url 'courses:delete_material' material.pk %}">Eliminar</a>
							{% endif %}
						{% endif %}
						</div>
					{% empty %}
						<em>Sin materias</em>
					{% endfor %}
				</td>
				<td>
					{% if user.is_authenticated %}
						{% if user.is_superuser or 'courses.change_course' in user_perms %}
							<a href="{% url 'courses:edit' item.instance.pk %}">Editar</a>
						{% endif %}
						{% if user.is_superuser or 'courses.delete_course' in user_perms %}
							<a href="{% url 'courses:delete' item.instance.pk %}">Eliminar</a>
						{% endif %}
					{% endif %}
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	{% else %}
	<p>No hay cursos definidos todavía.</p>
	{% endif %}
{% endblock %}
