{% extends 'base.html' %}
{% block title %}Reporte — Cooperadora{% endblock %}
{% load money_filters %}
{% block content %}
<h2>Reporte de Movimientos</h2>

<form method="get" class="form-inline">
  <label>Desde: <input type="date" name="desde" value="{{ desde }}"></label>
  &nbsp;
  <label>Hasta: <input type="date" name="hasta" value="{{ hasta }}"></label>
  &nbsp;
  <button class="btn" type="submit">Filtrar</button>
  &nbsp;
  <a class="btn" href="?{% if desde %}desde={{ desde }}&{% endif %}{% if hasta %}hasta={{ hasta }}&{% endif %}format=csv">Exportar CSV</a>
</form>

{% if errors %}
  <div class="errors">
    <ul>
      {% for e in errors %}<li>{{ e }}</li>{% endfor %}
    </ul>
  </div>
{% endif %}

<div class="table-wrapper">
  <table class="table">
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Tipo</th>
      <th style="text-align:right">Ingresos</th>
      <th style="text-align:right">Egresos</th>
      <th>Descripción</th>
    </tr>
  </thead>
  <tbody>
    {% for r in transactions %}
      <tr>
        <td>{{ r.date }}</td>
        <td>{{ r.type }}</td>
  <td style="text-align:right">{% if r.income %}{{ r.income|money }}{% else %}&nbsp;{% endif %}</td>
  <td style="text-align:right">{% if r.expense %}{{ r.expense|money }}{% else %}&nbsp;{% endif %}</td>
        <td>{{ r.description }}</td>
      </tr>
    {% empty %}
      <tr><td colspan="5">No hay transacciones para el rango seleccionado.</td></tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr>
      <td colspan="2" style="text-align:right"><strong>Totales:</strong></td>
  <td style="text-align:right"><strong>{{ total_income|money }}</strong></td>
  <td style="text-align:right"><strong>{{ total_expense|money }}</strong></td>
      <td></td>
    </tr>
    <tr>
      <td colspan="2" style="text-align:right"><strong>Total general:</strong></td>
  <td style="text-align:right" colspan="3"><strong>{% if total_general < 0 %}<span style="color:red">{{ total_general|money }}</span>{% else %}{{ total_general|money }}{% endif %}</strong></td>
    </tr>
  </tfoot>
  </table>
</div>

{% endblock %}
